[OK] Base de donnee globale BNGRC
    [OK] Base de donnee
            - script sql/16022026-01-schema.sql
            - table regions (idRegion, nom)
            - table ville (idVille, idRegion, nom)
            - table categories (idCategorie, nom)
            - table produit (idProduit, nom, idCategorie, prixUnitaire)
            - table unite (idUnite, nom)
            - table besoins (idBesoin, idVille, idProduit, quantite, quantiteInitiale, idUnite, status: non_dispatche/dispatche/achete, date)
            - table dons (idDon, idProduit, idUnite, quantite, donateur, dateDon)
            - table typeParametreAchat (idTypeParametreAchat, code, libelle)
            - table parametreAchat (idParametreAchat, idTypeParametreAchat, valeurDecimal, dateApplication, actif, dateMaj)
            - table achats (idAchat, idBesoin, idVille, idProduit, idUnite, quantite, prixUnitaire, tauxFrais, montantSousTotal, montantFrais, montantTotal, dateAchat, statut, commentaire)
            - table achatDons (idAchatDon, idAchat, idDon, montantAffecte)
            - table StockBNGRC (idStock, idProduit, idUnite, quantite)
            - table MvtStock (idMvt, typeMvt, idProduit, idUnite, quantite, dateMvt)
            - table DistributionVille (idDistribution, idVille, idProduit, idUnite, quantite, dateDistribution)
            - index idx_dons_produit_unite_date
            - index idx_parametre_achat_type_actif
            - index idx_achats_ville_date
            - index idx_achats_besoin
            - index idx_achats_produit_unite
            - index idx_achat_don_don
            - index idx_besoins_status_date_id
            - index idx_distribution_ville_date
    [OK] Donnees initiales / test
            - script sql/16022026-02-init-data.sql (5 villes cyclone S3 + besoins initiaux + dons + stock + mvt don)
            - script sql/16022026-03-test-data-distribution.sql
    [OK] php
            - bootstrap DB via Flight::db() dans app/config/services.php
    [OK] js
            - aucun

[OK] Helpers de vue mutualises (anti-redondance)
    [OK] php
            - app/config/vue_helpers.php
                * vue_echapper(...): string
                * vue_formater_nombre(float): string
                * vue_formater_quantite(float, ?string): string
                * vue_formater_montant_ar(float): string
                * vue_formater_prix_unitaire_ar(float): string
                * vue_formater_date_humaine(..., bool): string
            - app/config/bootstrap.php
                * require('vue_helpers.php')
    [OK] Affichage
            - suppression des closures locales dupliquees dans les vues
            - format quantite + unite applique sur les tableaux pertinents
            - format date humain applique (ex: 12 fev 2026)
            - format prix/montant en Ar applique

[OK] Ajouter Stock BNGRC
    [OK] Base de donnee
            - table StockBNGRC (idStock, idProduit, idUnite, quantite)
            - table MvtStock (typeMvt='don' lors de l'initialisation)
    [OK] Affichage
            - page app/views/stock/initialisation.php
                + formulaire (id_produit, id_unite, quantite)
                + recap lignes de stock
                + recap quantite totale
                + messages succes/erreur
    [OK] php
            - repository
                + app/repositories/StockRepository.php
                    * obtenirProduits(): array
                    * obtenirUnites(): array
                    * obtenirStockDetaille(): array
                    * obtenirStockVerrouille(int, int): array
                    * insererStock(int, int, float): void
                    * incrementerStock(int, float): void
                    * insererMouvementDon(int, int, float): void
                    * demarrerTransaction(): void
                    * validerTransaction(): void
                    * annulerTransaction(): void
                    * estEnTransaction(): bool
            - service
                + app/services/StockService.php
                    * obtenirDonneesInitialisation(): array
                    * ajouterStockInitial(int, int, float): array
                    * obtenirDonneesConsultation(): array
                    * construireResumeStock(array): array
            - controller
                + app/controllers/StockController.php
                    * afficherPageInitialisation(): void
                    * enregistrerInitialisation(): void
    [OK] js
            - aucun metier

[OK] Consultation du stock
    [OK] Base de donnee
            - lecture table StockBNGRC + produit + unite
    [OK] Affichage
            - page app/views/stock/consultation.php
                + tableau idProduit / produit / quantite(unite)
                + recap global lignes et quantite
    [OK] php
            - controller app/controllers/StockController.php
                * afficherPageConsultation(): void
            - service app/services/StockService.php
                * obtenirDonneesConsultation(): array
            - repository app/repositories/StockRepository.php
                * obtenirStockDetaille(): array
    [OK] js
            - aucun

[OK] Insertion des dons
    [OK] Base de donnee
            - table dons (insertion don)
            - table StockBNGRC (maj quantite)
            - table MvtStock (typeMvt='don')
    [OK] Affichage
            - page app/views/dons/index.php
                + formulaire (produit, unite, quantite, donateur, date_don)
                + historique dons recents
                + recap total dons / quantite
    [OK] php
            - repository
                + app/repositories/DonRepository.php
                    * obtenirProduits(): array
                    * obtenirUnites(): array
                    * obtenirDonsRecents(): array
                    * obtenirStockVerrouille(int, int): array
                    * insererStock(int, int, float): void
                    * incrementerStock(int, float): void
                    * insererDon(int, int, float, string, ?string): void
                    * insererMouvementDon(int, int, float): void
                    * demarrerTransaction(): void
                    * validerTransaction(): void
                    * annulerTransaction(): void
                    * estEnTransaction(): bool
            - service
                + app/services/DonService.php
                    * obtenirDonneesPage(): array
                    * insererDon(int, int, float, string, ?string): void
                    * construireResume(array): array
            - controller
                + app/controllers/DonController.php
                    * afficherPageDons(): void
                    * enregistrerDon(): void
    [OK] js
            - aucun metier

[OK] Insertion des besoins (par ville)
    [OK] Base de donnee
            - table besoins (status='non_dispatche' par defaut, etat final possible: 'dispatche' ou 'achete')
            - liaison ville/region/produit/unite
    [OK] Affichage
            - page app/views/besoins/index.php
                + formulaire insertion besoin
                + filtre par ville
                + liste des besoins saisis (status, date humaine, montant estime en Ar)
                + recap total/dispatches/non dispatches
    [OK] php
            - repository
                + app/repositories/BesoinRepository.php
                    * obtenirVilles(): array
                    * obtenirProduits(): array
                    * obtenirUnites(): array
                    * obtenirBesoins(?int): array
                    * insererBesoin(int, int, float, int, ?string): void
            - service
                + app/services/BesoinService.php
                    * obtenirDonneesPage(?int): array
                    * insererBesoin(int, int, float, int, ?string): void
                    * construireResume(array): array
            - controller
                + app/controllers/BesoinController.php
                    * afficherPageBesoins(): void
                    * enregistrerBesoin(): void
    [OK] js
            - aucun metier

[OK] Distribution manuelle des dons (page separee)
    [OK] Base de donnee
            - table DistributionVille pour tracer ville/produit/unite/quantite/date
            - decrement StockBNGRC lors distribution
            - insertion MvtStock typeMvt='distribution'
            - mise a jour besoins seulement pour distributions materielles (ville/produit/unite)
            - distribution Argent/Ar: pas de maj besoins (achat manuel ensuite)
    [OK] Affichage
            - page app/views/distribution/index.php
                + formulaire distribution manuelle (ville, produit, unite, quantite, date)
                + filtre historique par ville
                + historique distributions manuelles
                + apercu stock actuel
    [OK] php
            - repository
                + app/repositories/DistributionManuelleRepository.php
                    * obtenirVilles(): array
                    * obtenirProduits(): array
                    * obtenirUnites(): array
                    * obtenirStockDetaille(): array
                    * obtenirDistributionsManuelles(?int): array
                    * obtenirStockVerrouille(int, int): array
                    * decrementerStock(int, float): void
                    * insererMouvementDistribution(int, int, float, ?string): void
                    * insererDistributionVille(int, int, int, float, ?string): void
                    * estDistributionArgent(int, int): bool
                    * obtenirBesoinsNonDispatcheVilleProduitUniteVerrouilles(int, int, int): array
                    * marquerBesoinDispatche(int): void
                    * mettreAJourQuantiteBesoin(int, float): void
                    * demarrerTransaction(): void
                    * validerTransaction(): void
                    * annulerTransaction(): void
                    * estEnTransaction(): bool
            - service
                + app/services/DistributionManuelleService.php
                    * obtenirDonneesPage(?int): array
                    * distribuerManuellement(int, int, int, float, ?string): array
                    * appliquerMiseAJourBesoinsSiMateriel(int, int, int, float): void
            - controller
                + app/controllers/DistributionManuelleController.php
                    * afficherPageDistribution(): void
                    * enregistrerDistribution(): void
    [OK] js
            - aucun metier

[OK] Simulation et validation automatique (page separee)
    [OK] Base de donnee
            - lecture besoins status='non_dispatche'
            - mode dispatch par date (date ASC puis idBesoin ASC)
            - mode dispatch par quantite (quantite ASC puis date ASC puis idBesoin ASC)
            - mode dispatch proportionnel (allocation par coefficient et arrondi inferieur)
            - validation: decrement StockBNGRC + MvtStock typeMvt='distribution' + trace DistributionVille
            - update besoins (status='dispatche' ou quantite restante)
            - bouton reinitialisation: retour au point de depart via script sql/16022026-02-init-data.sql
    [OK] Affichage
            - page app/views/simulation/index.php
                + etat initial "simulation non lancee"
                + select mode de dispatch (date / quantite / proportionnel)
                + bouton simuler (sans impact base)
                + bouton valider dispatch (application reelle)
                + bouton reinitialiser donnees
                + tableau detail besoins simules
                + projection stock apres simulation
    [OK] php
            - repository
                + app/repositories/DistributionRepository.php
                    * obtenirBesoinsNonDispatcheParPriorite(): array
                    * obtenirStockAvecLibelles(): array
                    * obtenirStockVerrouille(int, int): array
                    * decrementerStock(int, float): void
                    * enregistrerMouvementDistribution(int, int, float): void
                    * insererDistributionVille(int, int, int, float): void
                    * marquerBesoinDispatche(int): void
                    * mettreAJourQuantiteBesoin(int, float): void
                    * demarrerTransaction(): void
                    * validerTransaction(): void
                    * annulerTransaction(): void
                    * estEnTransaction(): bool
                    * reinitialiserDonneesDepuisScriptSql(string): void
            - service
                + app/services/DistributionService.php
                    * simulerDistribution(string): array
                    * validerDistribution(string): array
                    * genererCleStock(int, int): string
                    * obtenirModesDispatchDisponibles(): array
                    * normaliserModeDispatch(string): string
                    * obtenirLibelleModeDispatch(string): string
                    * reinitialiserDonneesPointDepart(): void
            - controller
                + app/controllers/DistributionController.php
                    * afficherPageSimulation(): void
                    * simulerDistribution(): void
                    * validerDistribution(): void
                    * reinitialiserDonneesPointDepart(): void
    [OK] js
            - aucun metier

[OK] Dashboard (resume + details par ville)
    [OK] Base de donnee
            - resume besoins par ville
            - resume dons recus
            - resume distributions par ville (base DistributionVille)
            - etat global stock
            - details besoins par ville
            - details dons obtenus par ville (inclut distributions manuelles + simulation validee)
    [OK] Affichage
            - page app/views/dashboard/index.php
                + cartes indicateurs
                + 4 tableaux de synthese
                + bouton "Voir details" par ville
                + lightbox details (besoins / dons distribues)
    [OK] php
            - repository
                + app/repositories/DashboardRepository.php
                    * obtenirResumeBesoinsParVille(): array
                    * obtenirResumeDonsRecus(): array
                    * obtenirResumeDistributionsParVille(): array
                    * obtenirEtatGlobalStock(): array
                    * obtenirDetailsBesoinsParVille(): array
                    * obtenirDetailsDistributionsParVille(): array
            - service
                + app/services/DashboardService.php
                    * obtenirDonneesDashboard(): array
                    * sommeValeurs(array, string): float
                    * construireDetailsParVille(array, array, array): array
            - controller
                + app/controllers/DashboardController.php
                    * afficherDashboard(): void
    [OK] js
            - assets/js/dashboard-details.js
                + ouverture/fermeture lightbox
                + injection template ville
                + fermeture clic exterieur + touche Escape

[OK] Achats via dons en argent (V2)
    [OK] Base de donnee
            - table typeParametreAchat (parametre de frais configurable)
            - table parametreAchat (valeur active du taux frais)
            - table achats (historique achats depuis besoins restants)
            - table achatDons (trace disponible pour evolutions)
            - extension MvtStock typeMvt='achat'
            - donnees de base: categorie Financier, produit Argent, unite Ar
            - achat partiel: mise a jour besoins.quantite (reste reel)
            - si quantite achetee couvre le besoin, status besoin passe a 'achete'
    [OK] Affichage
            - page app/views/achats/index.php
                + formulaire achat depuis besoins restants
                + filtre ville
                + liste besoins restants a acheter
                + liste achats effectues
                + recap budget argent / frais / montants
    [OK] php
            - repository
                + app/repositories/AchatRepository.php
                    * obtenirVilles(): array
                    * obtenirBesoinsRestantsPourAchat(?int): array
                    * obtenirAchats(?int): array
                    * obtenirTauxFraisAchatActif(): float
                    * obtenirProduitArgentUniteAr(): array
                    * obtenirSoldeArgentDistribueDisponible(int, int, ?int): float
                    * obtenirBesoinVerrouille(int): array
                    * obtenirQuantiteAcheteeBesoinVerrouille(int): float
                    * obtenirStockVerrouille(int, int): array
                    * obtenirMontantArgentDistribueVilleVerrouille(int, int, int): float
                    * obtenirMontantTotalAchatsVilleVerrouille(int): float
                    * insererAchat(...): int
                    * insererStock(int, int, float): void
                    * incrementerStock(int, float): void
                    * insererMouvementAchat(int, int, float, ?string): void
                    * marquerBesoinAchete(int): void
                    * mettreAJourQuantiteBesoin(int, float): void
                    * demarrerTransaction(): void
                    * validerTransaction(): void
                    * annulerTransaction(): void
                    * estEnTransaction(): bool
            - service
                + app/services/AchatService.php
                    * obtenirDonneesPage(?int): array
                    * enregistrerAchatDepuisBesoin(int, float, ?string, ?string): void
                    * construireResume(array): array
            - controller
                + app/controllers/AchatController.php
                    * afficherPageAchats(): void
                    * enregistrerAchat(): void
                    * construireUrlAchats(int, string, string): string
    [OK] js
            - aucun metier

[OK] Recapitulation montants (Ajax)
    [OK] Base de donnee
            - calculs sur besoins + achats (totaux, satisfaits, restants)
            - detail des montants par ville
    [OK] Affichage
            - page app/views/recapitulation/index.php
                + cartes de montants globaux
                + tableau detail par ville
                + bouton actualiser en Ajax
                + horodatage derniere actualisation
    [OK] php
            - repository
                + app/repositories/RecapitulationRepository.php
                    * obtenirResumeMontantsBesoins(): array
                    * obtenirResumeMontantsParVille(): array
            - service
                + app/services/RecapitulationService.php
                    * obtenirDonneesRecapitulation(): array
            - controller
                + app/controllers/RecapitulationController.php
                    * afficherPageRecapitulation(): void
                    * obtenirDonneesRecapitulationAjax(): void
                    * envoyerJson(array): void
    [OK] js
            - assets/js/recapitulation.js
                + appel Ajax GET /recapitulation/donnees
                + mise a jour dynamique cartes + tableau
                + message succes/erreur

[OK] CRUD Referentiels
    [OK] Base de donnee
            - utilise tables regions / ville / categories / produit / unite
            - utilise tables typeParametreAchat / parametreAchat
    [OK] Affichage
            - page app/views/referentiels/index.php
                + CRUD region
                + CRUD ville
                + CRUD categorie
                + CRUD produit (avec prix unitaire)
                + CRUD unite
                + CRUD type parametre achat (code, libelle)
                + CRUD parametre achat (valeur, date application, actif)
    [OK] php
            - repository
                + app/repositories/ReferentielRepository.php
                    * obtenirRegions(): array
                    * ajouterRegion(string): void
                    * modifierRegion(int, string): void
                    * supprimerRegion(int): void
                    * obtenirVilles(): array
                    * ajouterVille(int, string): void
                    * modifierVille(int, int, string): void
                    * supprimerVille(int): void
                    * obtenirCategories(): array
                    * ajouterCategorie(string): void
                    * modifierCategorie(int, string): void
                    * supprimerCategorie(int): void
                    * obtenirProduits(): array
                    * ajouterProduit(string, int, float): void
                    * modifierProduit(int, string, int, float): void
                    * supprimerProduit(int): void
                    * obtenirUnites(): array
                    * ajouterUnite(string): void
                    * modifierUnite(int, string): void
                    * supprimerUnite(int): void
                    * obtenirTypesParametreAchat(): array
                    * ajouterTypeParametreAchat(string, string): void
                    * modifierTypeParametreAchat(int, string, string): void
                    * supprimerTypeParametreAchat(int): void
                    * obtenirParametresAchat(): array
                    * ajouterParametreAchat(int, float, string, int): void
                    * modifierParametreAchat(int, int, float, string, int): void
                    * supprimerParametreAchat(int): void
            - service
                + app/services/ReferentielService.php
                    * obtenirDonneesPage(): array
                    * ajouter/modifier/supprimer region, ville, categorie, produit, unite
                    * ajouter/modifier/supprimer type parametre achat
                    * ajouter/modifier/supprimer parametre achat
            - controller
                + app/controllers/ReferentielController.php
                    * afficherPageReferentiels(): void
                    * actions CRUD par entite
    [OK] js
            - aucun metier

[OK] UI globale moderne + mode dark/light
    [OK] Affichage
            - layout unique app/views/layout.php
                + sidebar navigation
                + header global
                + bouton switch theme
                + menus separes: distribution manuelle / simulation / referentiels
            - style global assets/css/app.css
                + design light moderne
                + mode dark complet
                + correction contraste titres/formulaires/tableaux
                + lightbox centree sur zone contenu (hors sidebar)
    [OK] php
            - routes centralisees app/config/routes.php
            - gestion BASE_URL app/config/constant.php
    [OK] js
            - assets/js/theme.js
                + detect theme systeme
                + persistence localStorage
                + toggle clair/sombre
            - assets/js/select-personnalise.js
                + select custom global
                + application auto sur contenu injecte (dashboard/lightbox)
